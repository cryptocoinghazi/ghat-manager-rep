I need to deploy this GitHub repository (https://github.com/cryptocoinghazi/ghat-manager-rep.git) as a single Docker container on Railway. Here are the exact steps:

## 1. First, analyze the project structure:
- Run: `ls -la` to see the full structure
- Run: `find . -name "package.json" -o -name "requirements.txt" -o -name "*.js" -o -name "*.py" | head -10`
- Check: `cat package.json` in both frontend and backend directories

## 2. Create this Dockerfile in the ROOT directory:

```dockerfile
# Multi-stage Docker build for Ghat Manager
# Stage 1: Build frontend
FROM node:18-alpine AS frontend-builder

# Set working directory for frontend
WORKDIR /app/frontend

# Copy frontend package files
COPY frontend/package*.json ./

# Install frontend dependencies
RUN npm ci --only=production

# Copy frontend source code
COPY frontend/ .

# Build frontend
RUN npm run build

# Stage 2: Build backend
FROM node:18-alpine AS backend-builder

# Set working directory for backend
WORKDIR /app/backend

# Copy backend package files
COPY backend/package*.json ./

# Install backend dependencies
RUN npm ci --only=production

# Copy backend source code
COPY backend/ .

# Stage 3: Final production image
FROM node:18-alpine

# Install curl for health checks
RUN apk add --no-cache curl

# Create non-root user
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001

# Set working directory
WORKDIR /app

# Copy built frontend from stage 1
COPY --from=frontend-builder /app/frontend/build ./frontend/build

# Copy backend from stage 2
COPY --from=backend-builder /app/backend ./backend

# Copy package.json from backend
COPY --from=backend-builder /app/backend/package*.json ./

# Set environment variables
ENV NODE_ENV=production
ENV PORT=3000

# Change ownership to non-root user
RUN chown -R nodejs:nodejs /app

# Switch to non-root user
USER nodejs

# Set backend as working directory
WORKDIR /app/backend

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

# Expose port
EXPOSE 3000

# Start the application
CMD ["node", "server.js"]


3. Create a .dockerignore file in root:


# Dependencies
node_modules
npm-debug.log

# Environment files
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Build outputs
dist
build
out

# OS files
.DS_Store
Thumbs.db

# IDE files
.vscode
.idea
*.swp
*.swo

# Git
.git
.gitignore

# Logs
*.log
logs

# Coverage
coverage
.nyc_output

# Misc
.dockerignore
Dockerfile
docker-compose.yml
railway.json
render.yaml


4. Create a railway.json configuration for Railway:

{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "Dockerfile"
  },
  "deploy": {
    "numReplicas": 1,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10,
    "healthcheckPath": "/health",
    "healthcheckTimeout": 30,
    "startTimeout": 60
  }
}

5. Modify backend to serve frontend files:
Add this to your backend server file (likely server.js, app.js, or index.js):

// Add at the top if not already there
const path = require('path');

// Add this AFTER your API routes but BEFORE error handling
if (process.env.NODE_ENV === 'production') {
  // Serve static files from frontend build
  app.use(express.static(path.join(__dirname, '../frontend/build')));
  
  // Handle React routing - return all requests to React app
  app.get('*', (req, res) => {
    // Don't serve API routes through React
    if (req.path.startsWith('/api/')) {
      return next();
    }
    res.sendFile(path.join(__dirname, '../frontend/build', 'index.html'));
  });
}

// Make sure to listen on PORT environment variable
const PORT = process.env.PORT || 3000;
app.listen(PORT, '0.0.0.0', () => {
  console.log(`Server running on port ${PORT} in ${process.env.NODE_ENV} mode`);
});

6. Add a health check endpoint to backend:

app.get('/health', (req, res) => {
  res.status(200).json({
    status: 'healthy',
    timestamp: new Date().toISOString(),
    service: 'ghat-manager',
    uptime: process.uptime()
  });
});

7. Update frontend API calls to use relative URLs:
In your frontend code (likely in frontend/src), update all fetch/axios calls:

// Change from:
const response = await fetch('http://localhost:5000/api/endpoint');

// To:
const response = await fetch('/api/endpoint');

8. Create environment variables file .env.example:

# Server
PORT=3000
NODE_ENV=production

# Database
DATABASE_URL=your_database_connection_string
MONGODB_URI=your_mongodb_uri

# Security
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRE=7d

# CORS
CORS_ORIGIN=*

# Logging
LOG_LEVEL=info

9. Build and test the Docker image locally:
Run these commands:

# Build the Docker image
docker build -t ghat-manager .

# Run the container locally
docker run -p 3000:3000 --env-file .env ghat-manager

# Check if it's running
curl http://localhost:3000/health

